{"version":3,"file":"static/js/940.c6d7013c.chunk.js","mappings":"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","sources":["pages/Distribution.js"],"sourcesContent":["import React, { Suspense, useState, useEffect } from 'react'\nimport { Link } from 'react-router-dom'\nimport { \n  CContainer, \n  CSpinner, \n  CButton, \n  CTable, \n  CTableRow, \n  CTableHead,\n  CTableHeaderCell,\n  CTableBody,\n  CTableDataCell,\n  CCard,\n  CCardBody,\n  CCardHeader,\n  CCol,\n  CRow,\n} from '@coreui/react'\nimport { AppSidebar, AppFooter, AppHeader } from '../components/index'\n\nimport deleteIcon from 'src/assets/images/delete.png'\nimport { useUsersContext } from \"./../chat-app-new/context/usersContext\";\nimport { delDistribution } from 'src/http/adminAPI';\n\nconst Distribution = () => {\n  const { distributions: messages } = useUsersContext();\n  const [distributions, setDistributions]= useState([]);\n  const [loading, setLoading]= useState(true);\n\n  //get Distribution\n  useEffect(() => {\n    const fetchData = async () => {\n\t\t\t//let response = await getDistributions();\n      console.log(\"distributions: \", messages)\n\n      let strReceivers = ''\n\n      const arrDitributions = []\n      messages.map((distrib, index) => {\n        JSON.parse(distrib.receivers).map((receiver)=>{\n          strReceivers = receiver.label + ' '\n        })\n\n        const d = new Date(distrib.createdAt);\n\t\t\t\tconst year = d.getFullYear();\n\t\t\t\tconst month = String(d.getMonth()+1).padStart(2, \"0\");\n\t\t\t\tconst day = String(d.getDate()).padStart(2, \"0\");\n\t\t\t\tconst chas = d.getHours();\n\t\t\t\tconst minut = String(d.getMinutes()).padStart(2, \"0\");\n\t\t\t\tconst newDateMessage = `${day}.${month}.${year} ${chas}:${minut}`\n\n        const newDistribution = {\n          id: distrib.id,\n\t\t\t\t\tname: distrib.name,\n          text: distrib.text,\n          image: distrib.image.split('5000/')[1] !=='' ? distrib.image: '',\n          button: distrib.button,\n          receivers: strReceivers,//JSON.parse(distrib.receivers)[index-1].label,\n          datestart: newDateMessage,\n          status: distrib.delivered ? \"отправлено\" : \"не отправлено\",\n\t\t\t\t}\n        //console.log(index)\n        arrDitributions.push(newDistribution)\n      })\n\n      setDistributions(arrDitributions) \n      setLoading(false)\n    }\n\n    fetchData();\n    \n  },[messages])\n\n  {/* Удаление рассылки */}\n  const removeDescription = async(desk) => {\n    setDistributions(distributions.filter(p => p.id !== desk.id))\n    //удаление сообщения в базе данных\n    await delDistribution(desk.id)\n  }\n\n  return (\n    <div className='dark-theme'>\n      <AppSidebar />\n      <div className=\"wrapper d-flex flex-column min-vh-100 bg-uley\">\n        <AppHeader />\n        <div className=\"body flex-grow-1 px-3\">\n\n            <CContainer lg>\n                <Suspense fallback={<CSpinner color=\"primary\" />}>\n                  <>\n                    <h2>Рассылки</h2>\n                      <Link to={'/distribution_add'}><CButton color=\"primary\" size=\"lg\" >Новая рассылка</CButton></Link>\n                      <br />\n                      <br />\n                      <CRow>\n                        <CCol xs>\n                          <CCard className=\"mb-4\">\n                            <CCardHeader>Рассылки</CCardHeader>\n                            <CCardBody>\n\n                              <br /> \n\n                            {loading ? \n                                  \n                              <CSpinner/> :\n\n                              <CTable align=\"middle\" className=\"mb-0 border\" hover responsive>\n                                <CTableHead className='table-dark'>\n                                  <CTableRow>\n                                    {/* <CTableHeaderCell>№</CTableHeaderCell> */}\n                                    <CTableHeaderCell className=\"text-center\">Дата</CTableHeaderCell>\n                                    <CTableHeaderCell className=\"text-center\">Картинка</CTableHeaderCell>\n                                    <CTableHeaderCell className=\"text-center\">Кнопка</CTableHeaderCell>\n                                    <CTableHeaderCell className=\"text-center\">Текст</CTableHeaderCell>\n                                    <CTableHeaderCell className=\"text-center\">Получатели</CTableHeaderCell>   \n                                    <CTableHeaderCell className=\"text-center\">Статус</CTableHeaderCell>\n                                    <CTableHeaderCell className=\"text-center\">Управление</CTableHeaderCell>\n                                  </CTableRow>\n                                </CTableHead>\n                                <CTableBody>\n                                  {distributions.map((item, index) => (\n                                    <CTableRow v-for=\"item in tableItems\" key={index}>\n                                      {/* <CTableDataCell>\n                                        <div>{index+1}</div>\n                                      </CTableDataCell> */}\n                                      <CTableDataCell className=\"text-center\">\n                                        <div>{item.datestart}</div>\n                                      </CTableDataCell>      \n                                      <CTableDataCell className=\"text-center\">\n                                        {item.image.endsWith('.pdf') ?\n                                        <iframe src={item.image} height=\"120px\" width=\"200px\" title=\"myFramePdf\"/>\n                                        : <div>{item.image ? <a href={item.image} target='_blank' rel=\"noreferrer\"><img src={item.image} alt='' width={230} height={120} style={{objectFit: 'contain'}}></img></a> : ''}</div>\n                                        }\n                                      </CTableDataCell>\n                                      <CTableDataCell className=\"text-center\">\n                                        <div>{item.button}</div>\n                                      </CTableDataCell>\n                                      <CTableDataCell className=\"text-center\" style={{width: '50px'}}>\n                                        <div>{item.text}</div>\n                                      </CTableDataCell>\n                                      <CTableDataCell className=\"text-center\">\n                                        <div>{item.receivers}</div>\n                                      </CTableDataCell>\n                                      <CTableDataCell className=\"text-center\">\n                                        <div>{item.status}</div>\n                                      </CTableDataCell>\n                                      <CTableDataCell className=\"text-center\">\n                                        <CButton color=\"light\" onClick={() => removeDescription(item)}>\n                                          <img src={deleteIcon} alt='' width='10px' />\n                                        </CButton>\n                                      </CTableDataCell>\n                                    </CTableRow>\n                                  ))}\n                                </CTableBody>\n                              </CTable>\n                            }                              \n                            </CCardBody>\n                          </CCard>\n                        </CCol>\n                      </CRow>\n                  </>\n                </Suspense>\n            </CContainer>\n\n        </div>\n        <AppFooter />\n      </div>\n    </div>\n  )\n}\n\nexport default Distribution\n"],"names":["messages","useUsersContext","distributions","useState","setDistributions","loading","setLoading","useEffect","fetchData","console","log","strReceivers","arrDitributions","map","distrib","index","JSON","parse","receivers","receiver","label","d","Date","createdAt","year","getFullYear","month","String","getMonth","padStart","day","getDate","chas","getHours","minut","getMinutes","newDateMessage","newDistribution","id","name","text","image","split","button","datestart","status","delivered","push","removeDescription","desk","filter","p","delDistribution","className","lg","Suspense","fallback","color","to","size","xs","align","hover","responsive","item","endsWith","src","height","width","title","href","target","rel","alt","style","objectFit","onClick","deleteIcon"],"sourceRoot":""}